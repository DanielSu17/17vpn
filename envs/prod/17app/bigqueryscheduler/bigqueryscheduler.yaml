bigqueryToMetrics:
  - sql: '
  SELECT ((1 - (error_num/total_num)) * 100) as rate
  FROM (
  SELECT
  -- COUNT(comment) / COUNT(updateVersion) total_num
  SUM(CASE WHEN (comment IS NOT NULL AND comment != "5,6") THEN 1 ELSE 0 END) AS error_num,
  -- COUNT(comment),
  COUNT(updateVersion) AS total_num
  FROM (
  SELECT A.session_id, A.clientEventKey, A.action_type,
  A.config_os, appVersion, A.timestamp_utc, A.updateVersion,
  A.generic_text, A.comment
  FROM `MatomoCore.base_visit_action` AS A
  LEFT JOIN (
  SELECT DISTINCT(session_id), appVersion
  FROM `MatomoCore.base_session`
  WHERE appVersion is not null AND appVersion != "") AS user on user.session_id = A.session_id
  WHERE 1=1
  AND (appVersion >= "3.168.0" OR appVersion >= "2.78.0.0")
  AND (DATE(timestamp_utc) >= DATE_ADD(CURRENT_DATE(), INTERVAL -7 DAY)) AND DATE(timestamp_utc) <= CURRENT_DATE()
  AND action_type in ("Action", "Event")
  AND config_os in ("AND", "IOS")
  AND updateVersion is not null
  AND generic_text = "auto"
  ))
'
  bqResultCol: "rate"
  bqResultType: "float"
    metricsPkgName: "business"
    metricsKey: "slo.rate"
    metricsType: "avg"
    cronSpec: "0 0 0 * * 1"